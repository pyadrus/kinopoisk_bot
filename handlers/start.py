from aiogram import types
from aiogram.dispatcher import FSMContext

from keyboards.reply.categories_btn import create_categories_keyboard
from system.dispatcher import dp, bot


@dp.message_handler(commands=['start'])
async def greeting(message: types.Message, state: FSMContext):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start, –æ–Ω –∂–µ –ø–æ—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è üëã"""
    await state.finish()  # –ó–∞–≤–µ—Ä—à–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –º–∞—à–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
    await state.reset_state()  # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –º–∞—à–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π, –¥–æ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    with open("media/photos/greeting.jpg", "rb") as photo_file:  # –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ—Ç–æ –¥–ª—è –ø–æ—Å—Ç–∞
        categories_kb = create_categories_keyboard()
        post_greeting = ('–ü—Ä–∏–≤–µ—Ç! üëãüé• –Ø —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –∫–∏–Ω–æ–±–æ—Ç.\n\n'
                         '–Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ –Ω–∞–π—Ç–∏ –ª—É—á—à–∏–µ —Ñ–∏–ª—å–º—ã, —Ä–∞—Å—Å–∫–∞–∂—É –æ–± –∞–∫—Ç–µ—Ä–∞—Ö, –ø–æ–¥—Å–∫–∞–∂—É —Ä–µ–π—Ç–∏–Ω–≥–∏ –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ.\n\n'
                         '–ü—Ä–æ—Å—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–π, –∏ —è –ø–æ–º–æ–≥—É –Ω–∞–π—Ç–∏ –∏–¥–µ–∞–ª—å–Ω—ã–π —Ñ–∏–ª—å–º –¥–ª—è —Ç–≤–æ–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è! üòäüçøüé¨')
        await bot.send_photo(message.from_user.id, caption=post_greeting, photo=photo_file, reply_markup=categories_kb)


@dp.callback_query_handler(lambda c: c.data == "disagree")
async def disagree_handler(callback_query: types.CallbackQuery, state: FSMContext):
    await callback_query.message.answer('–í–æ—Ç —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç:\n'
                                        '/help - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–∞–Ω–¥–∞—Ö\n'
                                        '/search - –ø—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ —Ñ–∏–ª—å–º–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é\n'
                                        '/adv_search - –ø–æ–∏—Å–∫ —Ñ–∏–ª—å–º–∞ –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º\n'
                                        '/random - –ø–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–π —Ñ–∏–ª—å–º –∏–∑ –±–∞–∑—ã\n')


def register_greeting_handler():
    """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º handlers –¥–ª—è –±–æ—Ç–∞"""
    dp.register_message_handler(greeting)  # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start, –æ–Ω –∂–µ –ø–æ—Å—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è üëã
    dp.register_message_handler(disagree_handler)
